<!DOCTYPE html>
<html>
  <head>
    <title>Compare</title>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/jsondiffpatch/dist/jsondiffpatch.umd.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.19/lodash.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />

    <style>
      .buttons {
        position: sticky;
        bottom: 0;
        background: white;
        display: flex;
      }

      .buttons .btn {
        flex-grow: 1;
      }

      .change {
        padding: 10px;
        margin: 10px;
        border: solid black 2px;
      }

      .change[data-quality="unscored"],
      div.unscored, tr.unscored {
        background: beige;
      }

      .change[data-quality="better"],
      div.better, tr.better {
        background: lightgreen;
      }

      .change[data-quality="worse"],
      div.worse, tr.worse{
        background: lightcoral;
      }

      .change[data-quality="neutral"],
      div.neutral, tr.neutral {
        background: lightgrey;
      }

      .request-card {
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      #scoreboard {
        position: fixed;
        top: 0;
        right: 0;
        z-index: 10000;
      }

      /* https://benjamine.github.io/jsondiffpatch/formatters-styles/html.css */

      .jsondiffpatch-delta {
        font-family: "Bitstream Vera Sans Mono", "DejaVu Sans Mono", Monaco, Courier, monospace;
        font-size: 12px;
        margin: 0;
        padding: 0 0 0 12px;
        display: inline-block;
      }
      .jsondiffpatch-delta pre {
        font-family: "Bitstream Vera Sans Mono", "DejaVu Sans Mono", Monaco, Courier, monospace;
        font-size: 12px;
        margin: 0;
        padding: 0;
        display: inline-block;
      }
      ul.jsondiffpatch-delta {
        list-style-type: none;
        padding: 0 0 0 20px;
        margin: 0;
      }
      .jsondiffpatch-delta ul {
        list-style-type: none;
        padding: 0 0 0 20px;
        margin: 0;
      }
      .jsondiffpatch-added .jsondiffpatch-property-name,
      .jsondiffpatch-added .jsondiffpatch-value pre,
      .jsondiffpatch-modified .jsondiffpatch-right-value pre,
      .jsondiffpatch-textdiff-added {
        background: #bbffbb;
      }
      .jsondiffpatch-deleted .jsondiffpatch-property-name,
      .jsondiffpatch-deleted pre,
      .jsondiffpatch-modified .jsondiffpatch-left-value pre,
      .jsondiffpatch-textdiff-deleted {
        background: #ffbbbb;
        text-decoration: line-through;
      }
      .jsondiffpatch-unchanged,
      .jsondiffpatch-movedestination {
        color: gray;
      }
      .jsondiffpatch-unchanged,
      .jsondiffpatch-movedestination > .jsondiffpatch-value {
        transition: all 0.5s;
        -webkit-transition: all 0.5s;
        overflow-y: hidden;
      }
      .jsondiffpatch-unchanged-showing .jsondiffpatch-unchanged,
      .jsondiffpatch-unchanged-showing .jsondiffpatch-movedestination > .jsondiffpatch-value {
        max-height: 100px;
      }
      .jsondiffpatch-unchanged-hidden .jsondiffpatch-unchanged,
      .jsondiffpatch-unchanged-hidden .jsondiffpatch-movedestination > .jsondiffpatch-value {
        max-height: 0;
      }
      .jsondiffpatch-unchanged-hiding .jsondiffpatch-movedestination > .jsondiffpatch-value,
      .jsondiffpatch-unchanged-hidden .jsondiffpatch-movedestination > .jsondiffpatch-value {
        display: block;
      }
      .jsondiffpatch-unchanged-visible .jsondiffpatch-unchanged,
      .jsondiffpatch-unchanged-visible .jsondiffpatch-movedestination > .jsondiffpatch-value {
        max-height: 100px;
      }
      .jsondiffpatch-unchanged-hiding .jsondiffpatch-unchanged,
      .jsondiffpatch-unchanged-hiding .jsondiffpatch-movedestination > .jsondiffpatch-value {
        max-height: 0;
      }
      .jsondiffpatch-unchanged-showing .jsondiffpatch-arrow,
      .jsondiffpatch-unchanged-hiding .jsondiffpatch-arrow {
        display: none;
      }
      .jsondiffpatch-value {
        display: inline-block;
      }
      .jsondiffpatch-property-name {
        display: inline-block;
        padding-right: 5px;
        vertical-align: top;
      }
      .jsondiffpatch-property-name:after {
        content: ": ";
      }
      .jsondiffpatch-child-node-type-array > .jsondiffpatch-property-name:after {
        content: ": [";
      }
      .jsondiffpatch-child-node-type-array:after {
        content: "],";
      }
      div.jsondiffpatch-child-node-type-array:before {
        content: "[";
      }
      div.jsondiffpatch-child-node-type-array:after {
        content: "]";
      }
      .jsondiffpatch-child-node-type-object > .jsondiffpatch-property-name:after {
        content: ": {";
      }
      .jsondiffpatch-child-node-type-object:after {
        content: "},";
      }
      div.jsondiffpatch-child-node-type-object:before {
        content: "{";
      }
      div.jsondiffpatch-child-node-type-object:after {
        content: "}";
      }
      .jsondiffpatch-value pre:after {
        content: ",";
      }
      li:last-child > .jsondiffpatch-value pre:after,
      .jsondiffpatch-modified > .jsondiffpatch-left-value pre:after {
        content: "";
      }
      .jsondiffpatch-modified .jsondiffpatch-value {
        display: inline-block;
      }
      .jsondiffpatch-modified .jsondiffpatch-right-value {
        margin-left: 5px;
      }
      .jsondiffpatch-moved .jsondiffpatch-value {
        display: none;
      }
      .jsondiffpatch-moved .jsondiffpatch-moved-destination {
        display: inline-block;
        background: #ffffbb;
        color: #888;
      }
      .jsondiffpatch-moved .jsondiffpatch-moved-destination:before {
        content: " => ";
      }
      ul.jsondiffpatch-textdiff {
        padding: 0;
      }
      .jsondiffpatch-textdiff-location {
        color: #bbb;
        display: inline-block;
        min-width: 60px;
      }
      .jsondiffpatch-textdiff-line {
        display: inline-block;
      }
      .jsondiffpatch-textdiff-line-number:after {
        content: ",";
      }
      .jsondiffpatch-error {
        background: red;
        color: white;
        font-weight: bold;
      }

      /* https://benjamine.github.io/jsondiffpatch/formatters-styles/annotated.css */
      .jsondiffpatch-annotated-delta {
        font-family: "Bitstream Vera Sans Mono", "DejaVu Sans Mono", Monaco, Courier, monospace;
        font-size: 12px;
        margin: 0;
        padding: 0 0 0 12px;
        display: inline-block;
      }
      .jsondiffpatch-annotated-delta pre {
        font-family: "Bitstream Vera Sans Mono", "DejaVu Sans Mono", Monaco, Courier, monospace;
        font-size: 12px;
        margin: 0;
        padding: 0;
        display: inline-block;
      }
      .jsondiffpatch-annotated-delta td {
        margin: 0;
        padding: 0;
      }
      .jsondiffpatch-annotated-delta td pre:hover {
        font-weight: bold;
      }
      td.jsondiffpatch-delta-note {
        font-style: italic;
        padding-left: 10px;
      }
      .jsondiffpatch-delta-note > div {
        margin: 0;
        padding: 0;
      }
      .jsondiffpatch-delta-note pre {
        font-style: normal;
      }
      .jsondiffpatch-annotated-delta .jsondiffpatch-delta-note {
        color: #777;
      }
      .jsondiffpatch-annotated-delta tr:hover {
        background: #ffc;
      }
      .jsondiffpatch-annotated-delta tr:hover > td.jsondiffpatch-delta-note {
        color: black;
      }
      .jsondiffpatch-error {
        background: red;
        color: white;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <div id="header"><</div>
    <div id="scoreboard"></div>
    <div id="change-list"></div>
    <div id="summary"></div>

    <template id="header-template">
      <div class="jumbotron">
        <h1 class="display-4">Compare</h1>
        <p class="lead">
          <b>{{old.apiEnv.host}} (old)</b><br />vs<br /><b>{{new.apiEnv.host}} (new)</b>
        </p>
        <hr class="my-4" />
        <p>Started <b>{{startTime}}</b>, ran <b>{{numQueriesRun}} queries</b> in <b>{{elapsed}}s</b></p>
        <table class="table">
          <tr>
            <th></th>
            <th>old</th>
            <th>new</th>
          </tr>
          <tr>
            <td>p99</td>
            <td>{{old.responseTimes.p99}}</td>
            <td>{{new.responseTimes.p99}}</td>
          </tr>
          <tr>
            <td>p95</td>
            <td>{{old.responseTimes.p95}}</td>
            <td>{{new.responseTimes.p95}}</td>
          </tr>
          <tr>
            <td>p90</td>
            <td>{{old.responseTimes.p90}}</td>
            <td>{{new.responseTimes.p90}}</td>
          </tr>
          <tr>
            <td>p50</td>
            <td>{{old.responseTimes.p50}}</td>
            <td>{{new.responseTimes.p50}}</td>
          </tr>
          <tr>
            <td>median</td>
            <td>{{old.responseTimes.median}}</td>
            <td>{{new.responseTimes.median}}</td>
          </tr>
        </table>
        <!-- <p class="lead">
          <a class="btn btn-primary btn-lg" href="#" role="button">Learn more</a>
        </p> -->
      </div>
    </template>

    <template id="scoreboard-template">
      <table class="scoreboard">
        <tr class="better">
          <td>Better</td>
          <td>{{better}}</td>
        </tr>
        <tr class="worse">
          <td>Worse</td>
          <td>{{worse}}</td>
        </tr>
        <tr class="neutral">
          <td>Neutral</td>
          <td>{{neutral}}</td>
        </tr>
        <tr class="unscored">
          <td>Unscored</td>
          <td>{{unscored}}</td>
        </tr>
      </table>
    </template>

    <template id="change-template">
      <div class="change card">
        <div class="card-text">
          <div class="card request-card">
            <div class="card-header">
              Change {{index}}/{{total}} -
              <a class="btn btn-outline-primary" href="{{oldUrl}}">old: {{oldHost}}</a> -
              <a class="btn btn-outline-primary" href="{{newUrl}}">new: {{newHost}}</a>
            </div>
            <div class="card-text p-2">
              <b><pre>{{params}}</pre></b>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              Delta
            </div>
            <div class="card-text p-2"><div class="delta-visual"></div></div>
          </div>
        </div>

        <div class="d-flex align-items-stretch buttons">
          <button class="btn btn-danger worse">Worse</button>
          <button class="btn btn-secondary neutral">Neutral</button>
          <button class="btn btn-success better">Better</button>
        </div>
      </div>
    </template>

    <template id="summary-template">
      <div class="card">
        <div class="card-body">
          <h2 class="card-title">Summary</h2>
          <div class="summary">
            {{#each summary as |values key|}}
            <div class="card {{key}}">
              <div class="card-body">
                <h5 class="card-title">{{key}}</h5>
                <ul class="list-group">
                  {{#each values as |value|}}
                  <li class="list-group-item">{{value}}</li>
                  {{/each}}
                </ul>
              </div>
            </div>
            {{/each}}
          </div>
        </div>
      </div>
    </template>

    <script>
      // prettier-ignore
      const json = {
  "startTime": "2020-07-14T22:23:29.752Z",
  "endTime": "2020-07-14T22:23:41.598Z",
  "command": "/Users/blackmad/Code/compare/node_modules/.bin/ts-node /Users/blackmad/Code/compare/lib/compare/compare.ts --new.host localhost:4100 --old.host localhost:3100 --input_csv addresses.csv --endpoint /v1/search --extra_params size=1 sources=osm,gn,wof --ignored_fields bbox geometry attribution timestamp via parsed_text gid id source_id --output_mode html",
  "totalQueries": 249,
  "numQueriesRun": 249,
  "old": {
    "apiEnv": {
      "host": "localhost:3100",
      "protocol": "http"
    },
    "responseTimes": {
      "p99": 710.0799999999999,
      "p95": 426.7499999999987,
      "p90": 363,
      "p50": 238,
      "median": 238
    },
    "statusCodes": {
      "200": 249
    }
  },
  "new": {
    "apiEnv": {
      "host": "localhost:4100",
      "protocol": "http"
    },
    "responseTimes": {
      "p99": 547.01,
      "p95": 361.24999999999994,
      "p90": 340,
      "p50": 205,
      "median": 205
    },
    "statusCodes": {
      "200": 249
    }
  },
  "changes": [
    {
      "id": "3acd7584478eb821256143f5d1ce00c7",
      "query": {
        "endpoint": "/v1/search",
        "method": "GET",
        "params": {
          "text": "2 Ambelwood Way",
          "size": "1",
          "sources": "osm,gn,wof"
        }
      },
      "delta": {
        "features": {
          "0": {
            "properties": {
              "confidence": [
                0.8,
                1
              ],
              "match_type": [
                "fallback",
                "exact"
              ]
            }
          },
          "_t": "a"
        }
      },
      "old": {
        "response": {
          "geocoding": {
            "version": "0.2",
            "attribution": "http://localhost:3100/attribution",
            "query": {
              "text": "2 Ambelwood Way",
              "size": 1,
              "sources": [
                "openstreetmap",
                "geonames",
                "whosonfirst"
              ],
              "private": false,
              "lang": {
                "name": "English",
                "iso6391": "en",
                "iso6393": "eng",
                "defaulted": true
              },
              "querySize": 20,
              "parser": "pelias",
              "parsed_text": {
                "subject": "2 Ambelwood Way",
                "housenumber": "2",
                "street": "Ambelwood Way"
              }
            },
            "engine": {
              "name": "Pelias",
              "author": "Mapzen",
              "version": "1.0"
            },
            "timestamp": 1594765410975
          },
          "type": "FeatureCollection",
          "features": [
            {
              "type": "Feature",
              "geometry": {
                "type": "Point",
                "coordinates": [
                  -90.70599,
                  38.775647
                ]
              },
              "properties": {
                "id": "node/6022798541",
                "gid": "openstreetmap:address:node/6022798541",
                "layer": "address",
                "source": "openstreetmap",
                "source_id": "node/6022798541",
                "name": "2410 Ambelwood Lane",
                "housenumber": "2410",
                "street": "Ambelwood Lane",
                "postalcode": "63368",
                "confidence": 0.8,
                "match_type": "fallback",
                "accuracy": "point",
                "country": "United States",
                "country_gid": "whosonfirst:country:85633793",
                "country_a": "USA",
                "region": "Missouri",
                "region_gid": "whosonfirst:region:85688661",
                "region_a": "MO",
                "county": "St. Charles County",
                "county_gid": "whosonfirst:county:102086159",
                "county_a": "SA",
                "localadmin": "Weldon Spring Township",
                "localadmin_gid": "whosonfirst:localadmin:404518205",
                "locality": "O'fallon",
                "locality_gid": "whosonfirst:locality:85972035",
                "continent": "North America",
                "continent_gid": "whosonfirst:continent:102191575",
                "label": "2410 Ambelwood Lane, O'fallon, MO, USA"
              }
            }
          ],
          "bbox": [
            -90.70599,
            38.775647,
            -90.70599,
            38.775647
          ]
        },
        "status": 200,
        "url": "http://localhost:3100/v1/search?text=2+Ambelwood+Way&size=1&sources=osm,gn,wof"
      },
      "new": {
        "response": {
          "geocoding": {
            "version": "0.2",
            "attribution": "http://localhost:4100/attribution",
            "query": {
              "text": "2 Ambelwood Way",
              "size": 1,
              "sources": [
                "openstreetmap",
                "geonames",
                "whosonfirst"
              ],
              "private": false,
              "lang": {
                "name": "English",
                "iso6391": "en",
                "iso6393": "eng",
                "via": "default",
                "defaulted": true
              },
              "querySize": 20,
              "parser": "pelias",
              "parsed_text": {
                "subject": "2 Ambelwood Way",
                "housenumber": "2",
                "street": "Ambelwood Way"
              }
            },
            "engine": {
              "name": "Pelias",
              "author": "Mapzen",
              "version": "1.0"
            },
            "timestamp": 1594765411195
          },
          "type": "FeatureCollection",
          "features": [
            {
              "type": "Feature",
              "geometry": {
                "type": "Point",
                "coordinates": [
                  -90.70599,
                  38.775647
                ]
              },
              "properties": {
                "id": "node/6022798541",
                "gid": "openstreetmap:address:node/6022798541",
                "layer": "address",
                "source": "openstreetmap",
                "source_id": "node/6022798541",
                "name": "2410 Ambelwood Lane",
                "housenumber": "2410",
                "street": "Ambelwood Lane",
                "postalcode": "63368",
                "confidence": 1,
                "match_type": "exact",
                "accuracy": "point",
                "country": "United States",
                "country_gid": "whosonfirst:country:85633793",
                "country_a": "USA",
                "region": "Missouri",
                "region_gid": "whosonfirst:region:85688661",
                "region_a": "MO",
                "county": "St. Charles County",
                "county_gid": "whosonfirst:county:102086159",
                "county_a": "SA",
                "localadmin": "Weldon Spring Township",
                "localadmin_gid": "whosonfirst:localadmin:404518205",
                "locality": "O'fallon",
                "locality_gid": "whosonfirst:locality:85972035",
                "continent": "North America",
                "continent_gid": "whosonfirst:continent:102191575",
                "label": "2410 Ambelwood Lane, O'fallon, MO, USA"
              }
            }
          ],
          "bbox": [
            -90.70599,
            38.775647,
            -90.70599,
            38.775647
          ]
        },
        "status": 200,
        "url": "http://localhost:4100/v1/search?text=2+Ambelwood+Way&size=1&sources=osm,gn,wof"
      }
    },
    {
      "id": "b150fffafca19a71b401cadfb7a84366",
      "query": {
        "endpoint": "/v1/search",
        "method": "GET",
        "params": {
          "text": "622 Thomas Street",
          "size": "1",
          "sources": "osm,gn,wof"
        }
      },
      "delta": {
        "features": {
          "0": {
            "properties": {
              "source": [
                "mixed",
                "openstreetmap"
              ],
              "name": [
                "622 Thomas Street",
                "622 Thomas S Boyland Street"
              ],
              "street": [
                "Thomas Street",
                "Thomas S Boyland Street"
              ],
              "confidence": [
                0.8,
                1
              ],
              "match_type": [
                "interpolated",
                "exact"
              ],
              "region": [
                "West Virginia",
                "New York"
              ],
              "region_gid": [
                "whosonfirst:region:85688589",
                "whosonfirst:region:85688543"
              ],
              "region_a": [
                "WV",
                "NY"
              ],
              "county": [
                "Ritchie County",
                "Kings County"
              ],
              "county_gid": [
                "whosonfirst:county:102083393",
                "whosonfirst:county:102082361"
              ],
              "county_a": [
                "RI",
                "KI"
              ],
              "locality": [
                "Harrisville",
                "New York"
              ],
              "locality_gid": [
                "whosonfirst:locality:101731699",
                "whosonfirst:locality:85977539"
              ],
              "label": [
                "622 Thomas Street, Harrisville, WV, USA",
                "622 Thomas S Boyland Street, Brooklyn, New York, NY, USA"
              ],
              "postalcode": [
                "11212"
              ],
              "locality_a": [
                "NYC"
              ],
              "borough": [
                "Brooklyn"
              ],
              "borough_gid": [
                "whosonfirst:borough:421205765"
              ],
              "neighbourhood": [
                "Brownsville"
              ],
              "neighbourhood_gid": [
                "whosonfirst:neighbourhood:85808127"
              ]
            }
          },
          "_t": "a"
        }
      },
      "old": {
        "response": {
          "geocoding": {
            "version": "0.2",
            "attribution": "http://localhost:3100/attribution",
            "query": {
              "text": "622 Thomas Street",
              "size": 1,
              "sources": [
                "openstreetmap",
                "geonames",
                "whosonfirst"
              ],
              "private": false,
              "lang": {
                "name": "English",
                "iso6391": "en",
                "iso6393": "eng",
                "defaulted": true
              },
              "querySize": 20,
              "parser": "libpostal",
              "parsed_text": {
                "number": "622",
                "street": "thomas street"
              }
            },
            "engine": {
              "name": "Pelias",
              "author": "Mapzen",
              "version": "1.0"
            },
            "timestamp": 1594765413564
          },
          "type": "FeatureCollection",
          "features": [
            {
              "type": "Feature",
              "geometry": {
                "type": "Point",
                "coordinates": [
                  -81.056308,
                  39.2058823
                ]
              },
              "properties": {
                "id": "polyline:13284130",
                "gid": "mixed:address:polyline:13284130",
                "layer": "address",
                "source": "mixed",
                "source_id": "polyline:13284130",
                "name": "622 Thomas Street",
                "housenumber": "622",
                "street": "Thomas Street",
                "confidence": 0.8,
                "match_type": "interpolated",
                "accuracy": "point",
                "country": "United States",
                "country_gid": "whosonfirst:country:85633793",
                "country_a": "USA",
                "region": "West Virginia",
                "region_gid": "whosonfirst:region:85688589",
                "region_a": "WV",
                "county": "Ritchie County",
                "county_gid": "whosonfirst:county:102083393",
                "county_a": "RI",
                "locality": "Harrisville",
                "locality_gid": "whosonfirst:locality:101731699",
                "continent": "North America",
                "continent_gid": "whosonfirst:continent:102191575",
                "label": "622 Thomas Street, Harrisville, WV, USA"
              }
            }
          ],
          "bbox": [
            -81.056308,
            39.2058823,
            -81.056308,
            39.2058823
          ]
        },
        "status": 200,
        "url": "http://localhost:3100/v1/search?text=622+Thomas+Street&size=1&sources=osm,gn,wof"
      },
      "new": {
        "response": {
          "geocoding": {
            "version": "0.2",
            "attribution": "http://localhost:4100/attribution",
            "query": {
              "text": "622 Thomas Street",
              "size": 1,
              "sources": [
                "openstreetmap",
                "geonames",
                "whosonfirst"
              ],
              "private": false,
              "lang": {
                "name": "English",
                "iso6391": "en",
                "iso6393": "eng",
                "via": "default",
                "defaulted": true
              },
              "querySize": 20,
              "parser": "libpostal",
              "parsed_text": {
                "housenumber": "622",
                "street": "thomas street"
              }
            },
            "engine": {
              "name": "Pelias",
              "author": "Mapzen",
              "version": "1.0"
            },
            "timestamp": 1594765413690
          },
          "type": "FeatureCollection",
          "features": [
            {
              "type": "Feature",
              "geometry": {
                "type": "Point",
                "coordinates": [
                  -73.912889,
                  40.665543
                ]
              },
              "properties": {
                "id": "way/249538386",
                "gid": "openstreetmap:address:way/249538386",
                "layer": "address",
                "source": "openstreetmap",
                "source_id": "way/249538386",
                "name": "622 Thomas S Boyland Street",
                "housenumber": "622",
                "street": "Thomas S Boyland Street",
                "postalcode": "11212",
                "confidence": 1,
                "match_type": "exact",
                "accuracy": "point",
                "country": "United States",
                "country_gid": "whosonfirst:country:85633793",
                "country_a": "USA",
                "region": "New York",
                "region_gid": "whosonfirst:region:85688543",
                "region_a": "NY",
                "county": "Kings County",
                "county_gid": "whosonfirst:county:102082361",
                "county_a": "KI",
                "locality": "New York",
                "locality_gid": "whosonfirst:locality:85977539",
                "locality_a": "NYC",
                "borough": "Brooklyn",
                "borough_gid": "whosonfirst:borough:421205765",
                "neighbourhood": "Brownsville",
                "neighbourhood_gid": "whosonfirst:neighbourhood:85808127",
                "continent": "North America",
                "continent_gid": "whosonfirst:continent:102191575",
                "label": "622 Thomas S Boyland Street, Brooklyn, New York, NY, USA"
              }
            }
          ],
          "bbox": [
            -73.912889,
            40.665543,
            -73.912889,
            40.665543
          ]
        },
        "status": 200,
        "url": "http://localhost:4100/v1/search?text=622+Thomas+Street&size=1&sources=osm,gn,wof"
      }
    }
  ]
};

      const changes = json.changes;

      function renderScoreboardAndSummary() {
        const scoreboardValues = {
          neutral: 0,
          better: 0,
          worse: 0,
          unscored: 0,
        };

        document
          .querySelectorAll(".change")
          .forEach((node) => (scoreboardValues[node.dataset.quality] += 1));

        var template = document.getElementById("scoreboard-template").innerHTML;
        var renderScoreboardTemplate = Handlebars.compile(template);

        document.getElementById("scoreboard").innerHTML = renderScoreboardTemplate(
          scoreboardValues
        );

        // summary

        const summarySections = {
          neutral: [],
          better: [],
          worse: [],
          unscored: [],
        };
        document
          .querySelectorAll(".change")
          .forEach((node) => summarySections[node.dataset.quality].push(node.dataset.params));

        const summaryTemplate = document.getElementById("summary-template").innerHTML;
        const renderSummaryTemplate = Handlebars.compile(summaryTemplate);

        document.getElementById("summary").innerHTML = renderSummaryTemplate({
          summary: summarySections,
        });
      }

      function renderHeader() {
        var template = document.getElementById("header-template").innerHTML;
        var renderHeaderTemplate = Handlebars.compile(template);

        document.getElementById("header").innerHTML = renderHeaderTemplate({
          old: json.old,
          new: json.new,
          startTime: new Date(json.startTime).toString(),
          elapsed: (new Date(json.endTime).getTime() - new Date(json.startTime).getTime()) / 1000,
          numQueriesRun: json.numQueriesRun,
        });
      }

      function createElementFromHTML(htmlString) {
        var div = document.createElement("div");
        div.innerHTML = htmlString.trim();

        // Change this to div.childNodes to support multiple top-level nodes
        return div.firstChild;
      }

      const changeList = document.getElementById("change-list");

      var template = document.getElementById("change-template").innerHTML;
      var renderChangeTemplate = Handlebars.compile(template);
      changes.forEach((change, index) => {
        const changeNode = createElementFromHTML(
          renderChangeTemplate({
            index: index + 1,
            total: changes.length,
            params: JSON.stringify(change.query.params, null, 2),
            oldUrl: change.old.url,
            newUrl: change.new.url,
            oldHost: json.old.apiEnv.host,
            newHost: json.new.apiEnv.host,
          })
        );

        changeNode.querySelector(".delta-visual").innerHTML = jsondiffpatch.formatters.html.format(
          change.delta,
          change.old.response
        );

        changeList.append(changeNode);

        function scoreResult(score) {
          changeNode.dataset.quality = score;

          localStorage.setItem(change.id, score);

          renderScoreboardAndSummary();
        }

        changeNode.dataset.quality = localStorage.getItem(change.id) || "unscored";
        changeNode.dataset.params = JSON.stringify(change.query.params);

        changeNode.querySelector(".better").addEventListener("click", () => scoreResult("better"));
        changeNode.querySelector(".worse").addEventListener("click", () => scoreResult("worse"));
        changeNode
          .querySelector(".neutral")
          .addEventListener("click", () => scoreResult("neutral"));
      });

      renderScoreboardAndSummary();
      renderHeader();
    </script>
  </body>
</html>
